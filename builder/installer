#!/bin/sh


gradlePublishLocal() {
  buildTag=$(git describe --tags --abbrev=0)
  rm -rf "$1/build"
  echo "Publishing $1:$buildTag"
  if ! gradle -Pgroup=com.github.softwareplace.springboot.plugin "$1":assemble "$1":publishToMavenLocal -Pversion="$buildTag";
  then
    echo "Publish failed $1:$buildTag"
    exit 1
  fi
}

gradlePublishLocal "build-configuration"
gradlePublishLocal "kotlin"
gradlePublishLocal "java"
gradlePublishLocal "kotlin-openapi"
gradlePublishLocal "java-openapi"
gradlePublishLocal "java-submodule"
gradlePublishLocal "kotlin-submodule"

echo "All modules built and published successfully."
